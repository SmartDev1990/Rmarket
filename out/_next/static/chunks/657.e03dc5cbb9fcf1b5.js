"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[657],{30657:function(e,i,t){t.r(i),t.d(i,{Deserializers:function(){return d},Serializer:function(){return p}});var a=t(95985),r=(e=a.O.PNG)=>`data:${e};base64,`,o=class{constructor(e){this.version="3.12.0",this.spriteOrder=0,this.mapRelativeCropPointToImageSpace=e=>{const i=a.lb.relativeToAbsolutePoint(e,this.cropSpace,!1);return a.lb.pointFromSpaceToSpace(i,this.cropSpace,this.imageSpace,!1)},this.mapRelativeCropSizeToScaledImageSize=e=>e*Math.min(this.outputSize.height*this.outputScale.x,this.outputSize.width*this.outputScale.y),this.mapRelativeCropSizeToUnscaledImageSize=e=>e*Math.min(this.outputSize.height,this.outputSize.width),this.editor=e}static deserializeFilter(e){return{intensity:e.intensity,identifier:e.identifier}}static deserializeAdjustments(e){return{...e}}static deserializeOverlay(e){return{identifier:e.identifier,opacity:e.intensity,blendMode:e.blendMode.replace(/([ _][a-z])/g,(e=>e.toUpperCase().replace(" ","").replace("_","")))}}static initializeEmptyTransform(){return{outputRotation:0,flipHorizontally:!1,flipVertically:!1,start:{x:0,y:0},end:{x:1,y:1},rotation:0}}static deserialzeColor(e){return e&&e.rgba?e.rgba:[0,0,0,0]}validateVersion(e){return this.version===e}static checkIfPlatformHTML(e){return"html5"===e}static deserializeStickers(e){return{identifier:e.identifier,opacity:e.alpha||0,tintMode:e.tintMode||"none",tintColor:o.deserialzeColor(e.tintColor)}}checkIsSerialisationValid(e){if("string"!==typeof e&&this.validateVersion(e.version))return!0;if("string"===typeof e)throw new Error("Invalid input of type string, please provide an object");return!1}deserializeImage(e){const i={};return e.image&&(i.image={width:e.image.width,height:e.image.height,data:e.image.data?e.image.data.replace(r(),""):""},i.image.data=i.image.data?r()+i.image.data:""),i}deserializeTransformation(e){const i={},t=e.operations.find((e=>"orientation"===e.type)),a=e.operations.find((e=>"transform"===e.type)),[r]=this.editor.engine.getRootContainers();return this.previewPosition=this.editor.transformToolStore.defaultCropMaskPosition,this.previewSize=this.editor.transformToolStore.maxCropMaskSize,this.imageSpace=r,i.transform=o.initializeEmptyTransform(),null!=t&&(i.transform.outputRotation=t.options.rotation,i.transform.flipHorizontally=t.options.flipHorizontally||!1,i.transform.flipVertically=t.options.flipVertically||!1),a&&(i.transform.start=a.options.start,i.transform.end=a.options.end,i.transform.rotation=a.options.rotation||0,i.transform.identifier=a.options.meta?a.options.meta.identifier:""),i}deserialize(e){var i,t;const r={};e.meta&&!o.checkIfPlatformHTML(e.meta.platform)&&console.warn("Read serialisation from another Platform");const s=this.editor.engineMediator.output.container.getResolution(),{size:n}=this.editor.engineMediator.image.container.getBounds();return this.outputSize=s,this.imageSize=n,this.cropSpace=this.editor.engine.getOutputContainer(),this.outputScale=this.cropSpace.getScale(),e.operations.forEach((e=>{switch(e.type){case"filter":r.filter=o.deserializeFilter(e.options);break;case"adjustments":r.adjustment=o.deserializeAdjustments(e.options);break;case"focus":r.focus=this.deserializeFocus(e.options);break;case"sprite":const{sprites:i}=e.options;i.forEach((e=>{switch(e.type){case"frame":r.frame=this.deserializeFrame(e.options);break;case"overlay":r.overlay=o.deserializeOverlay(e.options);break;case"brush":r.brush?r.brush.strokes.push(...this.deserializeBrush(e.options).strokes):r.brush=this.deserializeBrush(e.options);break;case"sticker":case"text":case"textdesign":r.sprite||(r.sprite={spriteIdList:[],sticker:{},text:{},textdesign:{},common:{}});const i=(0,a.Na)();r.sprite.spriteIdList.push(i),r.sprite.common[i]={order:this.spriteOrder,position:this.mapRelativeCropPointToImageSpace(e.options.position),tool:a.E.STICKER,rotation:e.options.rotation||0,flipHorizontally:e.options.flipHorizontally,flipVertically:e.options.flipVertically},this.spriteOrder+=1,e.type===a.E.STICKER?(r.sprite.common[i].tool=a.E.STICKER,r.sprite.common[i].size={width:this.mapRelativeCropSizeToScaledImageSize(e.options.dimensions.x),height:this.mapRelativeCropSizeToScaledImageSize(e.options.dimensions.y)},r.sprite.sticker[i]=o.deserializeStickers(e.options)):e.type===a.E.TEXT?(r.sprite.common[i].tool=a.E.TEXT,r.sprite.text[i]=this.deserializeTexts(e.options)):e.type===a.E.TEXT_DESIGN&&(r.sprite.common[i].tool=a.E.TEXT_DESIGN,r.sprite.textdesign[i]=this.deserializeTextDesign(e.options))}}))}})),e.assetLibrary&&(r.customStickers=(null==(t=null==(i=e.assetLibrary)?void 0:i.assets)?void 0:t.stickers)||[]),r}deserializeFrame(e){return{identifier:e.identifier,opacity:e.alpha,width:this.mapRelativeCropSizeToUnscaledImageSize(e.size),color:o.deserialzeColor(e.tintColor)}}deserializeFocus(e){switch(e.type){case"linear":return{identifier:"linear",linear:this.deserializeLinearFocus(e.options)};case"gaussian":return{identifier:"gaussian",gaussian:this.deserializeGaussianFocus(e.options)};case"radial":return{identifier:"radial",radial:this.deserializeRadialFocus(e.options)};case"mirrored":return{identifier:"mirrored",mirrored:this.deserializeMirroredFocus(e.options)}}}deserializeRadialFocus(e){return{center:this.mapRelativeCropPointToImageSpace(e.start),radius:new a.Pa(this.mapRelativeCropPointToImageSpace(e.start)).subtract(new a.Pa(this.mapRelativeCropPointToImageSpace(e.end))).magnitude,blurRadius:this.mapRelativeCropSizeToScaledImageSize(e.blurRadius)}}deserializeLinearFocus(e){return{start:this.mapRelativeCropPointToImageSpace(e.start),end:this.mapRelativeCropPointToImageSpace(e.end),blurRadius:this.mapRelativeCropSizeToScaledImageSize(e.blurRadius)}}deserializeGaussianFocus(e){return{blurRadius:this.mapRelativeCropSizeToScaledImageSize(e.blurRadius)}}deserializeMirroredFocus(e){const i=new a.Pa(this.mapRelativeCropPointToImageSpace(e.start)).subtract(new a.Pa(this.mapRelativeCropPointToImageSpace(e.end)));return{origin:new a.Pa(this.mapRelativeCropPointToImageSpace(e.start)).add(new a.Pa(this.mapRelativeCropPointToImageSpace(e.end))).divide(2),rotation:Math.atan2(i.y,i.x),size:this.mapRelativeCropSizeToScaledImageSize(e.size),blurRadius:this.mapRelativeCropSizeToScaledImageSize(e.blurRadius)}}deserializeTexts(e){return{identifier:(0,a.La)(e.fontIdentifier),fontSize:this.mapRelativeCropSizeToScaledImageSize(e.fontSize),width:this.mapRelativeCropSizeToScaledImageSize(e.maxWidth),alignment:e.alignment,textColor:o.deserialzeColor(e.color),backgroundColor:o.deserialzeColor(e.backgroundColor),lineHeight:e.lineHeight,text:e.text}}deserializeTextDesign(e){return{identifier:e.identifier,width:this.mapRelativeCropSizeToScaledImageSize(e.width),padding:this.mapRelativeCropSizeToScaledImageSize(e.padding),color:o.deserialzeColor(e.color),seed:e.seed,text:e.text,isInverted:e.inverted}}deserializeBrush(e){return{strokes:e.paths.map((e=>({path:{controlPoints:e.points.map(this.mapRelativeCropPointToImageSpace)},brush:{id:"imgly_brush_radial",color:o.deserialzeColor(e.brush.color),size:e.brush.size,hardness:e.brush.hardness}})))}}},s=(e=a.O.PNG)=>`data:${e};base64,`,n=class{constructor(e){this.version="3.9.0",this.spriteOrder=0,this.mapRelativeCropPointToImageSpace=e=>{const i=a.lb.relativeToAbsolutePoint(e,this.cropSpace,!1);return a.lb.pointFromSpaceToSpace(i,this.cropSpace,this.imageSpace,!1)},this.mapRelativeCropSizeToScaledImageSize=e=>e*Math.min(this.outputSize.height*this.outputScale.x,this.outputSize.width*this.outputScale.y),this.mapRelativeCropSizeToUnscaledImageSize=e=>e*Math.min(this.outputSize.height,this.outputSize.width),this.editor=e}static deserializeFilter(e){return{intensity:e.intensity,identifier:e.identifier}}static deserializeAdjustments(e){return{...e}}static deserializeOverlay(e){return{identifier:e.identifier,opacity:e.intensity,blendMode:e.blendMode.replace(/([ _][a-z])/g,(e=>e.toUpperCase().replace(" ","").replace("_","")))}}static initializeEmptyTransform(){return{outputRotation:0,flipHorizontally:!1,flipVertically:!1,start:{x:0,y:0},end:{x:1,y:1},rotation:0}}static deserialzeColor(e){return e&&e.rgba?e.rgba:[0,0,0,0]}validateVersion(e){return this.version===e}static checkIfPlatformHTML(e){return"html5"===e}static deserializeStickers(e){return{identifier:e.identifier,opacity:e.alpha||0,tintMode:e.tintMode||"none",tintColor:n.deserialzeColor(e.tintColor)}}checkIsSerialisationValid(e){if("string"!==typeof e&&this.validateVersion(e.version))return!0;if("string"===typeof e)throw new Error("Invalid input of type string, please provide an object");return!1}deserializeImage(e){const i={};return e.image&&(i.image={width:e.image.width,height:e.image.height,data:e.image.data?e.image.data.replace(s(),""):""},i.image.data=i.image.data?s()+i.image.data:""),i}deserializeTransformation(e){const i={},t=e.operations.find((e=>"orientation"===e.type)),a=e.operations.find((e=>"transform"===e.type)),[r]=this.editor.engine.getRootContainers();return this.previewPosition=this.editor.transformToolStore.defaultCropMaskPosition,this.previewSize=this.editor.transformToolStore.maxCropMaskSize,this.imageSpace=r,i.transform=n.initializeEmptyTransform(),null!=t&&(i.transform.outputRotation=t.options.rotation,i.transform.flipHorizontally=t.options.flipHorizontally||!1,i.transform.flipVertically=t.options.flipVertically||!1),a&&(i.transform.start=a.options.start,i.transform.end=a.options.end,i.transform.rotation=a.options.rotation||0,i.transform.identifier=a.options.meta?a.options.meta.identifier:""),i}deserialize(e){var i,t;const r={};e.meta&&!n.checkIfPlatformHTML(e.meta.platform)&&console.warn("Read serialisation from another Platform");const o=this.editor.engineMediator.output.container.getResolution(),{size:s}=this.editor.engineMediator.image.container.getBounds();return this.outputSize=o,this.imageSize=s,this.cropSpace=this.editor.engine.getOutputContainer(),this.outputScale=this.cropSpace.getScale(),e.operations.forEach((e=>{switch(e.type){case"filter":r.filter=n.deserializeFilter(e.options);break;case"adjustments":r.adjustment=n.deserializeAdjustments(e.options);break;case"focus":r.focus=this.deserializeFocus(e.options);break;case"sprite":const{sprites:i}=e.options;i.forEach((e=>{switch(e.type){case"frame":r.frame=this.deserializeFrame(e.options);break;case"overlay":r.overlay=n.deserializeOverlay(e.options);break;case"brush":r.brush?r.brush.strokes.push(...this.deserializeBrush(e.options).strokes):r.brush=this.deserializeBrush(e.options);break;case"sticker":case"text":case"textdesign":r.sprite||(r.sprite={spriteIdList:[],sticker:{},text:{},textdesign:{},common:{}});const i=(0,a.Na)();r.sprite.spriteIdList.push(i),r.sprite.common[i]={order:this.spriteOrder,position:this.mapRelativeCropPointToImageSpace(e.options.position),tool:a.E.STICKER,rotation:e.options.rotation||0,flipHorizontally:e.options.flipHorizontally,flipVertically:e.options.flipVertically},this.spriteOrder+=1,e.type===a.E.STICKER?(r.sprite.common[i].tool=a.E.STICKER,r.sprite.common[i].size={width:this.mapRelativeCropSizeToScaledImageSize(e.options.dimensions.x),height:this.mapRelativeCropSizeToScaledImageSize(e.options.dimensions.y)},r.sprite.sticker[i]=n.deserializeStickers(e.options)):e.type===a.E.TEXT?(r.sprite.common[i].tool=a.E.TEXT,r.sprite.text[i]=this.deserializeTexts(e.options)):e.type===a.E.TEXT_DESIGN&&(r.sprite.common[i].tool=a.E.TEXT_DESIGN,r.sprite.textdesign[i]=this.deserializeTextDesign(e.options))}}))}})),e.assetLibrary&&(r.customStickers=(null==(t=null==(i=e.assetLibrary)?void 0:i.assets)?void 0:t.stickers)||[]),r}deserializeFrame(e){return{identifier:e.identifier,opacity:e.alpha,width:this.mapRelativeCropSizeToUnscaledImageSize(e.size),color:n.deserialzeColor(e.tintColor)}}deserializeFocus(e){switch(e.type){case"linear":return{identifier:"linear",linear:this.deserializeLinearFocus(e.options)};case"gaussian":return{identifier:"gaussian",gaussian:this.deserializeGaussianFocus(e.options)};case"radial":return{identifier:"radial",radial:this.deserializeRadialFocus(e.options)};case"mirrored":return{identifier:"mirrored",mirrored:this.deserializeMirroredFocus(e.options)};default:return}}deserializeRadialFocus(e){return{center:this.mapRelativeCropPointToImageSpace(e.start),radius:new a.Pa(this.mapRelativeCropPointToImageSpace(e.start)).subtract(new a.Pa(this.mapRelativeCropPointToImageSpace(e.end))).magnitude,blurRadius:this.mapRelativeCropSizeToScaledImageSize(e.blurRadius)}}deserializeLinearFocus(e){return{start:this.mapRelativeCropPointToImageSpace(e.start),end:this.mapRelativeCropPointToImageSpace(e.end),blurRadius:this.mapRelativeCropSizeToScaledImageSize(e.blurRadius)}}deserializeGaussianFocus(e){return{blurRadius:this.mapRelativeCropSizeToScaledImageSize(e.blurRadius)}}deserializeMirroredFocus(e){const i=new a.Pa(this.mapRelativeCropPointToImageSpace(e.start)).subtract(new a.Pa(this.mapRelativeCropPointToImageSpace(e.end)));return{origin:new a.Pa(this.mapRelativeCropPointToImageSpace(e.start)).add(new a.Pa(this.mapRelativeCropPointToImageSpace(e.end))).divide(2),rotation:Math.atan2(i.y,i.x),size:this.mapRelativeCropSizeToScaledImageSize(e.size),blurRadius:this.mapRelativeCropSizeToScaledImageSize(e.blurRadius)}}deserializeTexts(e){return{identifier:(0,a.La)(e.fontIdentifier),fontSize:this.mapRelativeCropSizeToScaledImageSize(e.fontSize),width:this.mapRelativeCropSizeToScaledImageSize(e.maxWidth),alignment:e.alignment,textColor:n.deserialzeColor(e.color),backgroundColor:n.deserialzeColor(e.backgroundColor),lineHeight:e.lineHeight,text:e.text}}deserializeTextDesign(e){return{identifier:e.identifier,width:this.mapRelativeCropSizeToScaledImageSize(e.width),padding:this.mapRelativeCropSizeToScaledImageSize(e.padding),color:n.deserialzeColor(e.color),seed:e.seed,text:e.text,isInverted:e.inverted}}deserializeBrush(e){return{strokes:e.paths.map((e=>({path:{controlPoints:e.points.map(this.mapRelativeCropPointToImageSpace)},brush:{id:"imgly_brush_radial",color:n.deserialzeColor(e.brush.color),size:e.brush.size,hardness:e.brush.hardness}})))}}},l="5.16.0",p=class{constructor(e,i,t,r,o,s){this.version="3.12.0",this.mapImagePointToRelativeCropPoint=e=>{const i=a.lb.pointFromSpaceToSpace(e,this.imageSpace,this.cropSpace,!1);return a.lb.absoluteToRelativePoint(i,this.cropSpace,!1)},this.mapSizeToRelativeUnscaledCropSize=e=>e/Math.min(this.outputSize.height,this.outputSize.width),this.mapSizeToRelativeScaledCropSize=e=>e/Math.min(this.outputSize.height*this.outputScale.x,this.outputSize.width*this.outputScale.y),this.getPointInDirection=(e,i=0,t=3)=>{const a=Math.tan(i),r=Math.sqrt(a**2+1);return{x:e.x+t/r,y:e.y+t*a/r}},this.previewPosition=e,this.previewSize=i,this.outputSize=t,this.imageSize=r,this.imageSpace=o,this.cropSpace=s,this.outputScale=s.getScale()}static serializeFilters(e){return{type:"filter",options:{intensity:e.intensity,identifier:e.identifier}}}static serializeAdjustments(e){return{type:"adjustments",options:e}}static serializeOverlay(e){return{type:"overlay",options:{identifier:e.identifier,intensity:e.opacity,blendMode:e.blendMode.replace(/[A-Z]/g,(e=>` ${e.toLowerCase()}`))}}}static serializeMetaData(){return{platform:"html5",version:l,createdAt:(new Date).toISOString()}}serialise(e,i,t){const a=p.serializeMetaData(),r={width:this.imageSize.width,height:this.imageSize.height};i&&(r.type=t,r.data=i);const o=[],s=[],{adjustment:n}=e;Object.keys(n).map((e=>n[e])).filter(Boolean).length&&o.push(p.serializeAdjustments(n));const{filter:l}=e;"identity"!==l.identifier&&o.push(p.serializeFilters(l));const{overlay:d}=e;if("identity"!==d.identifier&&s.push(p.serializeOverlay(d)),e.transform){const{transform:i,orientation:t}=this.serializeTransform(e.transform),a=[0!==i.options.start.x,0!==i.options.start.y,1!==i.options.end.x,1!==i.options.end.y,0!==i.options.rotation],r=[0!==t.options.rotation,!1!==t.options.flipVertically,!1!==t.options.flipHorizontally];a.some((e=>e))&&o.push(i),r.some((e=>e))&&o.push(t)}const{frame:c}=e;"identity"!==c.identifier&&s.push(this.serialzeFrame(c));const{focus:h}=e;if("identity"!==h.identifier&&o.push(this.serializeFocus(h)),e.sprite&&e.sprite.spriteIdList.forEach((i=>{const t=e.sprite.common[i];switch(t.tool){case"sticker":const a=e.sprite.sticker[i];s.push(this.serializeSticker(a,t,e.transform));break;case"text":const r=e.sprite.text[i];s.push(this.serializeText(r,t));break;case"textdesign":const o=e.sprite.textdesign[i];s.push(this.serializeTextDesign(o,t))}})),e.brush.strokes.length&&s.push({type:"brush",options:{paths:e.brush.strokes.map((e=>({points:e.path.controlPoints.map(this.mapImagePointToRelativeCropPoint),brush:{color:{rgba:e.brush.color},size:e.brush.size,hardness:e.brush.hardness}})))}}),s.length){const e={type:"sprite",options:{sprites:s}};o.push(e)}const m={assets:{stickers:e.customStickers}};return{version:this.version,meta:a,image:r,operations:o,assetLibrary:m}}serialzeFrame(e){return{type:"frame",options:{identifier:e.identifier,alpha:e.opacity,tintColor:{rgba:e.color},size:this.mapSizeToRelativeUnscaledCropSize(e.width)}}}serializeFocus(e){const i=Math.sqrt(this.previewSize.width**2+this.previewSize.height**2);switch(e.identifier){case a.ea.LINEAR:return{type:"focus",options:{type:"linear",options:{start:this.mapImagePointToRelativeCropPoint(e.linear.start),end:this.mapImagePointToRelativeCropPoint(e.linear.end),blurRadius:this.mapSizeToRelativeScaledCropSize(e.linear.blurRadius)}}};case a.ea.RADIAL:return{type:"focus",options:{type:"radial",options:{start:this.mapImagePointToRelativeCropPoint(e.radial.center),end:this.mapImagePointToRelativeCropPoint(this.getPointInDirection(e.radial.center,0,e.radial.radius)),blurRadius:this.mapSizeToRelativeScaledCropSize(e.radial.blurRadius),gradientRadius:.1}}};case a.ea.MIRRORED:const{mirrored:t}=e;return{type:"focus",options:{type:"mirrored",options:{start:this.mapImagePointToRelativeCropPoint(this.getPointInDirection(t.origin,t.rotation,i/2)),end:this.mapImagePointToRelativeCropPoint(this.getPointInDirection(t.origin,t.rotation,-i/2)),size:this.mapSizeToRelativeScaledCropSize(e.mirrored.size),blurRadius:this.mapSizeToRelativeScaledCropSize(e.mirrored.blurRadius),gradientSize:.1}}};default:return{type:"focus",options:{type:"gaussian",options:{blurRadius:this.mapSizeToRelativeScaledCropSize(e.gaussian.blurRadius)}}}}}serializeSticker(e,i,t){return{type:"sticker",options:{position:this.mapImagePointToRelativeCropPoint(i.position),dimensions:{x:this.mapSizeToRelativeScaledCropSize(i.size.width),y:this.mapSizeToRelativeScaledCropSize(i.size.height)},rotation:i.rotation,flipVertically:(i.flipVertically||!1)!==(t.flipVertically||!1),flipHorizontally:(i.flipHorizontally||!1)!==(t.flipHorizontally||!1),identifier:e.identifier,alpha:e.opacity,tintColor:{rgba:e.tintColor},tintMode:e.tintMode}}}serializeText(e,i){return{type:"text",options:{position:this.mapImagePointToRelativeCropPoint(i.position),rotation:i.rotation,flipVertically:!1,flipHorizontally:!1,fontIdentifier:e.identifier,fontSize:this.mapSizeToRelativeScaledCropSize(e.fontSize),maxWidth:this.mapSizeToRelativeScaledCropSize(e.width),text:e.text,lineHeight:e.lineHeight,color:{rgba:e.textColor},backgroundColor:{rgba:e.backgroundColor},alignment:e.alignment}}}serializeTextDesign(e,i){return{type:"textdesign",options:{position:this.mapImagePointToRelativeCropPoint(i.position),rotation:i.rotation,flipVertically:!1,flipHorizontally:!1,identifier:e.identifier,inverted:e.isInverted,text:e.text,seed:e.seed,width:this.mapSizeToRelativeScaledCropSize(e.width),padding:this.mapSizeToRelativeScaledCropSize(e.padding),color:{rgba:e.color}}}}serializeTransform(e){const{start:i,end:t}=e;return{transform:{type:"transform",options:{start:i,end:t,rotation:e.rotation,meta:{identifier:e.identifier}}},orientation:{type:"orientation",options:{rotation:e.outputRotation,flipHorizontally:e.flipHorizontally,flipVertically:e.flipVertically}}}}},d={"3.9.0":n,"3.12.0":o}}}]);